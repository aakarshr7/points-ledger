<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>üèÜ Points Ledger</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
/* =====================
   GLOBAL + VARIABLES
===================== */
:root {
  --aakarsh: #3b82f6;
  --rishika: #ec4899;
  --bg: #f6f7fb;
  --card: #ffffff;
  --text: #1f2937;
}

body.dark {
  --aakarsh: #60a5fa;
  --rishika: #f472b6;
  --bg: #020617;
  --card: #111827;
  --text: #e5e7eb;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: system-ui, sans-serif;
  background: var(--bg);
  color: var(--text);
}
body.sidebar-open {
  overflow: hidden;
}


/* =====================
   SIDEBAR
===================== */
.sidebar {
  position: fixed;
  top: 0;
  left: 0;
  width: 220px;
  height: 100%;
  background: var(--card);
  padding: 16px;
  box-shadow: 2px 0 8px rgba(0,0,0,.08);
  z-index: 10;
}

.sidebar h3 { text-align: center; margin-bottom: 10px; }

.sidebar ul { list-style: none; }

.sidebar li {
  background: var(--bg);
  padding: 8px;
  border-radius: 8px;
  margin-bottom: 8px;
  font-size: .85rem;
}
.main-wrapper {
  transition: filter 0.25s ease;
}
.sidebar {
  box-shadow: 4px 0 24px rgba(0,0,0,0.15);
}


/* =====================
   MOBILE SIDEBAR
===================== */
#toggleSidebar {
  position: fixed;
  top: 10px;
  left: 10px;
  display: none;
  background: #4f46e5;
  color: white;
  border: none;
  padding: 10px 14px;
  border-radius: 10px;
  font-size: 1.1rem;
  z-index: 20;
}


.overlay {
  position: fixed;
  inset: 0;
  background: transparent;
  display: none;
  z-index: 9;
}

.overlay.show {
  display: block;
}

.overlay.show { display: block; }

/* =====================
   LAYOUT
===================== */
.main-wrapper {
  margin-left: 240px;
  padding: 20px;
}

.layout {
  display: grid;
  grid-template-columns: 1fr 320px;
  gap: 16px;
}

.main { max-width: 760px; }

/* =====================
   CARDS
===================== */
.card {
  background: var(--card);
  padding: 16px;
  border-radius: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,.06);
  text-align: center;
}

.card.aakarsh { border-left: 6px solid var(--aakarsh); }
.card.rishika { border-left: 6px solid var(--rishika); }

.scoreboard {
  display: flex;
  gap: 12px;
  margin: 20px 0;
}

.points { font-size: 2.4rem; font-weight: bold; }

/* =====================
   CONTROLS
===================== */
.controls {
  background: var(--card);
  padding: 16px;
  border-radius: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,.06);
  margin-bottom: 14px;
}

input, select, button {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  border-radius: 10px;
  border: 1px solid #cbd5f5;
}

button {
  background: #4f46e5;
  color: white;
  border: none;
  cursor: pointer;
}

button.redeem { background: #16a34a; }

/* =====================
   LOG PANEL
===================== */
.log-panel {
  background: var(--card);
  padding: 12px;
  border-radius: 14px;
  height: calc(100vh - 40px);
  position: sticky;
  top: 20px;
  overflow-y: auto;
}

.log-panel ul { list-style: none; }

.log-panel li {
  background: var(--bg);
  padding: 8px;
  border-radius: 8px;
  margin-bottom: 8px;
  font-size: .85rem;
}

li.aakarsh { border-left: 4px solid var(--aakarsh); }
li.rishika { border-left: 4px solid var(--rishika); }

/* =====================
   ANIMATIONS
===================== */
@keyframes glowA { 50% { box-shadow: 0 0 18px var(--aakarsh); } }
@keyframes glowR { 50% { box-shadow: 0 0 18px var(--rishika); } }

.animate-aakarsh { animation: glowA .6s ease; }
.animate-rishika { animation: glowR .6s ease; }

/* =====================
   MOBILE
===================== */
@media (max-width: 768px) {
  #toggleSidebar { display: block; }
  .sidebar { transform: translateX(-100%); transition: .3s; }
  .sidebar.open { transform: translateX(0); }
  .main-wrapper { margin-left: 0; }
  .layout { display: block; }
  .log-panel { position: static; height: auto; margin-top: 16px; }
}
/* Hide toggle when sidebar is open (mobile only) */
@media (max-width: 768px) {
  body.sidebar-open #toggleSidebar {
    display: none;
  }
}
/* Blur background when sidebar is open */
@media (max-width: 768px) {
  body.sidebar-open .main-wrapper {
    filter: blur(6px);
    pointer-events: none;
    user-select: none;
  }

  body.sidebar-open .sidebar {
    filter: none;
  }
}


</style>
</head>

<body>

<button id="toggleSidebar">‚ò∞</button>
<div class="overlay" id="overlay"></div>

<div class="sidebar">
  <button id="darkToggle">üåô Dark Mode</button>
  <h3>üìñ Rules</h3>
  <ul>
    <li>‚ûï Points can be added or deducted with a valid reason.</li>
    <li>üîê Transactions require the correct PIN.</li>
    <li>üéÅ Redeem only if balance > 0.</li>
    <li>‚ö†Ô∏è Cannot redeem more points than available.</li>
    <li>üïí All transactions are timestamped and logged.</li>
    <li>üí∞ Points have no cash value.</li>
  </ul>
</div>

<div class="main-wrapper">
  <h1 style="text-align:center;">üèÜ Points Ledger</h1>

  <div class="layout">
    <div class="main">

      <div class="scoreboard">
        <div class="card aakarsh">
          <h3>Aakarsh</h3>
          <div class="points" id="aPoints">0</div>
        </div>
        <div class="card rishika">
          <h3>Rishika</h3>
          <div class="points" id="rPoints">0</div>
        </div>
      </div>

      <div class="controls">
        <input type="password" id="pin" placeholder="PIN" />
      </div>

      <div class="controls">
        <select id="receiver">
          <option>Aakarsh</option>
          <option>Rishika</option>
        </select>
        <input type="number" id="points" placeholder="Points (+ / -)" />
        <input type="text" id="reason" placeholder="Reason" />
        <button id="logBtn">Log Transaction</button>
      </div>

      <div class="controls">
        <select id="redeemPerson">
          <option>Aakarsh</option>
          <option>Rishika</option>
        </select>
        <input type="number" id="redeemPoints" placeholder="Redeem points" />
        <input type="text" id="redeemFor" placeholder="Redeem for" />
        <button class="redeem" id="redeemBtn">Redeem</button>
      </div>

    </div>

    <div class="log-panel">
      <h3>üìú Transactions</h3>
      <ul id="log"></ul>
    </div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, doc, getDoc, updateDoc, arrayUnion, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
const sidebar = document.querySelector(".sidebar");
const overlay = document.getElementById("overlay");

toggleSidebar.onclick = () => {
  sidebar.classList.add("open");
  overlay.classList.add("show");
  document.body.classList.add("sidebar-open");
};

overlay.onclick = () => {
  sidebar.classList.remove("open");
  overlay.classList.remove("show");
  document.body.classList.remove("sidebar-open");
};


/* üî• FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyCEcUYPvTYPVFOJSKxc-BQq0aQ4mNn9QV4",
  authDomain: "points-ledger-6b4a2.firebaseapp.com",
  projectId: "points-ledger-6b4a2",
  storageBucket: "points-ledger-6b4a2.firebasestorage.app",
  messagingSenderId: "206943500903",
  appId: "1:206943500903:web:c7a6772caa51cc94afb2c2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const ref = doc(db, "ledger", "main");

/* üîê PIN HASH */
const PIN_HASH = "b32e9fb81ce0d57edcc5b7ae2da77f06bc07020efbf896bd5984731b43bcf3c9";

let data = { Aakarsh: 0, Rishika: 0, log: [] };

/* üîë HASH */
async function hash(pin){
  const b = await crypto.subtle.digest("SHA-256", new TextEncoder().encode(pin));
  return [...new Uint8Array(b)].map(x=>x.toString(16).padStart(2,"0")).join("");
}

/* üéØ ANIMATION */
function animate(el, from, to){
  const s = performance.now();
  const d = 400;
  function f(t){
    const p = Math.min((t-s)/d,1);
    el.textContent = Math.round(from + (to-from)*p);
    if(p<1) requestAnimationFrame(f);
  }
  requestAnimationFrame(f);
}

function glow(user){
  const c = document.querySelector(user==="Aakarsh"?".aakarsh":".rishika");
  c.classList.remove("animate-aakarsh","animate-rishika");
  void c.offsetWidth;
  c.classList.add(user==="Aakarsh"?"animate-aakarsh":"animate-rishika");
}

/* üì• LOAD */
async function load(){
  const s = await getDoc(ref);
  if(!s.exists()) await setDoc(ref,data);
  else data=s.data();

  const aEl = document.getElementById("aPoints");
  const rEl = document.getElementById("rPoints");

  if(+aEl.textContent!==data.Aakarsh){ animate(aEl,+aEl.textContent,data.Aakarsh); glow("Aakarsh"); }
  if(+rEl.textContent!==data.Rishika){ animate(rEl,+rEl.textContent,data.Rishika); glow("Rishika"); }

  const log = document.getElementById("log");
  log.innerHTML="";
  [...data.log].reverse().forEach(e=>{
    const li=document.createElement("li");
    li.textContent=e.t+" ‚Äî "+e.m;
    li.className=e.u.toLowerCase();
    log.appendChild(li);
  });
}

/* ‚ûï LOG */
async function addTx(){
  if(await hash(pin.value)!==PIN_HASH) return alert("Wrong PIN");
  const r=receiver.value,p=+points.value;
  data[r]+=p;
  data.log.push({u:r,m:`${p>0?"+"+p:p} (${reason.value})`,t:new Date().toLocaleString()});
  await updateDoc(ref,{Aakarsh:data.Aakarsh,Rishika:data.Rishika,log:arrayUnion(data.log.at(-1))});
  load();
}

/* üéÅ REDEEM */
async function redeem(){
  if(await hash(pin.value)!==PIN_HASH) return alert("Wrong PIN");
  const r=redeemPerson.value,p=+redeemPoints.value;
  if(data[r]<p) return alert("Not enough points");
  data[r]-=p;
  data.log.push({u:r,m:`redeemed ${p} for ${redeemFor.value}`,t:new Date().toLocaleString()});
  await updateDoc(ref,{Aakarsh:data.Aakarsh,Rishika:data.Rishika,log:arrayUnion(data.log.at(-1))});
  load();
}

/* UI */
logBtn.onclick=addTx;
redeemBtn.onclick=redeem;

darkToggle.onclick=()=>{
  document.body.classList.toggle("dark");
  localStorage.setItem("dark",document.body.classList.contains("dark"));
};

if(localStorage.getItem("dark")) document.body.classList.add("dark");


load();
</script>
</body>
</html>
