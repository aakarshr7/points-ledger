<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>üèÜ Points Ledger</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* === Global Reset & Base === */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: system-ui, sans-serif;
  background: #f6f7fb;
  color: #333;
  margin: 0;
  padding: 0;
}

/* === Sidebar === */
.sidebar {
  position: fixed;
  left: 0;
  top: 0;
  height: 100%;
  width: 220px;
  background: #ffffff;
  box-shadow: 2px 0 8px rgba(0,0,0,0.08);
  padding: 20px;
  overflow-y: auto;
  z-index: 999;
}

.sidebar h3 {
  margin-top: 0;
  text-align: center;
}

.sidebar ul {
  list-style: none;
  padding: 0;
}

.sidebar li {
  margin-bottom: 12px;
  font-size: 0.9rem;
  background: #f6f7fb;
  padding: 8px;
  border-radius: 8px;
}

/* === Overlay for Mobile Sidebar === */
.overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.4);
  display: none;
  z-index: 998;
}

.overlay.show {
  display: block;
}

/* === Toggle Button === */
#toggleSidebar {
  position: fixed;
  top: 10px;
  left: 10px;
  z-index: 1000;
  background: #4f46e5;
  color: white;
  border: none;
  padding: 10px 14px;
  border-radius: 8px;
  font-size: 1rem;
  cursor: pointer;
  display: none; /* hidden on desktop */
}

/* === Main Content === */
.main {
  margin-left: 240px;
  padding: 20px;
  max-width: 720px;
}

h1, h3 {
  text-align: center;
}

.scoreboard {
  display: flex;
  justify-content: space-between;
  gap: 12px;
  margin: 20px 0;
}

.card {
  background: white;
  padding: 16px;
  border-radius: 14px;
  width: 100%;
  text-align: center;
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
}

.points {
  font-size: 2.2rem;
  font-weight: bold;
}

.controls {
  background: white;
  padding: 16px;
  border-radius: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.06);
  margin-bottom: 16px;
}

input, select, button {
  width: 100%;
  padding: 10px;
  margin-top: 8px;
  font-size: 1rem;
  border-radius: 10px;
  border: 1px solid #ddd;
}

button {
  cursor: pointer;
  border: none;
  background: #4f46e5;
  color: white;
  margin-top: 12px;
}

button.redeem {
  background: #16a34a;
}

ul {
  list-style: none;
  padding: 0;
}

li {
  background: white;
  margin-bottom: 8px;
  padding: 10px;
  border-radius: 10px;
  font-size: 0.9rem;
  box-shadow: 0 2px 6px rgba(0,0,0,0.04);
}

.footer {
  text-align: center;
  font-size: 0.8rem;
  color: #666;
  margin-top: 20px;
}

/* === Responsive (Mobile) === */
@media (max-width: 768px) {
  .sidebar {
    transform: translateX(-100%);
    transition: transform 0.3s ease;
  }

  .sidebar.open {
    transform: translateX(0);
  }

  #toggleSidebar {
    display: block;
  }

  .main {
    margin-left: 0;
  }
}
  /* === Dark Mode === */
body.dark {
  background: #0f172a;
  color: #e5e7eb;
}

body.dark .sidebar,
body.dark .card,
body.dark .controls,
body.dark li {
  background: #111827;
  color: #e5e7eb;
}

body.dark input,
body.dark select {
  background: #020617;
  color: #e5e7eb;
  border: 1px solid #334155;
}

body.dark button {
  background: #6366f1;
}

body.dark button.redeem {
  background: #22c55e;
}

body.dark .footer {
  color: #94a3b8;
}

body.dark .overlay {
  background: rgba(0,0,0,0.7);
}


  </style>
</head>
<div class="overlay" id="overlay"></div>
<body>
<button id="toggleSidebar">‚ò∞</button>

<h1>üèÜ Points Ledger</h1>

<div class="scoreboard">
  <div class="card">
    <h3>Aakarsh</h3>
    <div class="points" id="youPoints">0</div>
  </div>
  <div class="card">
    <h3>Rishika</h3>
    <div class="points" id="herPoints">0</div>
  </div>
</div>

<div class="controls">
  <h3>üîê Security</h3>
  <input type="password" id="pin" placeholder="Enter PIN" />
</div>

<div class="controls">
  <h3>‚ûï Add / Deduct Points</h3>
  
  
  <select id="receiver">
    <option value="Aakarsh">Aakarsh</option>
    <option value="Rishika">Rishika</option>
  </select>
  <input type="number" id="points" placeholder="e.g. 5000 (negative allowed)" />
  <input type="text" id="reason" placeholder="Reason" />
  <button id="logBtn">Log Transaction</button>
</div>

<div class="controls">
  <h3>üéÅ Redeem Points</h3>
  <select id="redeemPerson">
    <option value="Aakarsh">Aakarsh</option>
    <option value="Rishika">Rishika</option>
  </select>
  <input type="number" id="redeemPoints" placeholder="Points to redeem" />
  <input type="text" id="redeemFor" placeholder="Redeemed for (favor‚Ä¶)" />
  <button class="redeem" id="redeemBtn">Redeem</button>
</div>
<div class="sidebar">
  <button id="darkToggle" style="margin-bottom:12px;">
  üåô Dark Mode
</button>

  <h3>üìñ Rules</h3>
  <ul>
    <li>‚ûï Points can be added or deducted with a valid reason.</li>
    <li>üîê Transactions require the correct PIN.</li>
    <li>üéÅ Redeem only if balance > 0.</li>
    <li>‚ö†Ô∏è Cannot redeem more points than available.</li>
    <li>üïí All transactions are timestamped and logged.</li>
    <li>üí∞ Points have no cash value.</li>
  </ul>
</div>

<h3>üìú Transaction History</h3>
<ul id="log"></ul>

<div class="footer">
  Points have no cash value. Terms and Conditions apply.
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, doc, getDoc, setDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
  const sidebar = document.querySelector(".sidebar");
const toggleBtn = document.getElementById("toggleSidebar");
const overlay = document.getElementById("overlay");

toggleBtn.addEventListener("click", () => {
  sidebar.classList.add("open");
  overlay.classList.add("show");
});

overlay.addEventListener("click", () => {
  sidebar.classList.remove("open");
  overlay.classList.remove("show");
});
document.querySelectorAll(".sidebar li").forEach(li => {
  li.addEventListener("click", () => {
    sidebar.classList.remove("open");
    overlay.classList.remove("show");
  });
});

const darkToggle = document.getElementById("darkToggle");

// Load preference
if (localStorage.getItem("darkMode") === "on") {
  document.body.classList.add("dark");
}

// Toggle
darkToggle.addEventListener("click", () => {
  document.body.classList.toggle("dark");

  localStorage.setItem(
    "darkMode",
    document.body.classList.contains("dark") ? "on" : "off"
  );
});

  // üî• FIREBASE CONFIG (PASTE YOURS HERE)
  const firebaseConfig = {
  apiKey: "AIzaSyCEcUYPvTYPVFOJSKxc-BQq0aQ4mNn9QV4",
  authDomain: "points-ledger-6b4a2.firebaseapp.com",
  projectId: "points-ledger-6b4a2",
  storageBucket: "points-ledger-6b4a2.firebasestorage.app",
  messagingSenderId: "206943500903",
  appId: "1:206943500903:web:c7a6772caa51cc94afb2c2"
};

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const docRef = doc(db, "ledger", "main");

  // üîê Stored PIN hash (replace with actual SHA-256 hash of your PIN)
  const STORED_PIN_HASH = "b32e9fb81ce0d57edcc5b7ae2da77f06bc07020efbf896bd5984731b43bcf3c9";

  let data = { Aakarsh: 0, Rishika: 0, log: [] };

  async function hashPin(pin) {
    const encoded = new TextEncoder().encode(pin);
    const buffer = await crypto.subtle.digest("SHA-256", encoded);
    return Array.from(new Uint8Array(buffer))
      .map(b => b.toString(16).padStart(2, "0"))
      .join("");
  }

  async function checkPin() {
    const pin = document.getElementById("pin").value;
    const enteredHash = await hashPin(pin);
    return enteredHash === STORED_PIN_HASH;
  }

  async function loadData() {
  const snap = await getDoc(docRef);
  if (snap.exists()) {
    data = snap.data();
    document.getElementById("youPoints").textContent = data.Aakarsh;
    document.getElementById("herPoints").textContent = data.Rishika;
    document.getElementById("log").innerHTML = "";

    // Sort by sortTime before displaying
    const sortedLog = [...data.log].sort((a, b) => new Date(a.sortTime) - new Date(b.sortTime));

    sortedLog.forEach(item => {
      const li = document.createElement("li");
      li.textContent = `${item.displayTime} ‚Äî ${item.message}`;
      document.getElementById("log").appendChild(li);
    });
  } else {
    await setDoc(docRef, data);
  }
}


  async function addTransaction() {
  if (!(await checkPin())) {
    alert("‚ùå Incorrect PIN");
    return;
  }

  const receiver = document.getElementById("receiver").value;
  const points = parseInt(document.getElementById("points").value, 10);
  const reason = document.getElementById("reason").value;

  if (receiver === "you") {
    data.Aakarsh += points;
  } else {
    data.Rishika += points;
  }

  // üïí Create timestamps
  const now = new Date();
  const displayTime = now.toLocaleString("en-IN", { timeZone: "Asia/Kolkata" }); // IST
  const sortTime = now.toISOString(); // UTC ISO string for sorting

  // ‚úÖ Different message depending on positive or negative points
  let message;
  if (points < 0) {
    message = `${receiver === "Aakarsh" ? "Rishika" : "Aakarsh"} --  debited ${Math.abs(points)} points from ${receiver} for ${reason}`;
  } else {
    message = `${receiver === "Aakarsh" ? "Rishika" : "Aakarsh"} -- credited ${points} points to ${receiver} for ${reason}`;
  }

  // Transaction object with both fields
  const entry = {
    message,
    displayTime,
    sortTime
  };

  data.log.push(entry);

  await updateDoc(docRef, {
    Aakarsh: data.Aakarsh,
    Rishika: data.Rishika,
    log: arrayUnion(entry)
  });

  loadData();
}


  async function redeemPoints() {
  if (!(await checkPin())) {
    alert("‚ùå Incorrect PIN");
    return;
  }

  const person = document.getElementById("redeemPerson").value;
  const points = parseInt(document.getElementById("redeemPoints").value, 10);
  const redeemFor = document.getElementById("redeemFor").value;

  // ‚úÖ Check current balance
  const currentBalance = person === "Aakarsh" ? data.Aakarsh : data.Rishika;

  if (points <= 0) {
    alert("‚ö†Ô∏è You must enter a positive number of points to redeem.");
    return;
  }

  if (currentBalance <= 0) {
    alert(`‚ö†Ô∏è ${person} has no points to redeem.`);
    return;
  }

  if (points > currentBalance) {
    alert(`‚ö†Ô∏è Cannot redeem more points than available. Current balance: ${currentBalance}`);
    return;
  }

  // Deduct points
  if (person === "Aakarsh") {
    data.Aakarsh -= points;
  } else {
    data.Rishika -= points;
  }

  // üïí Create timestamps
  const now = new Date();
  const displayTime = now.toLocaleString("en-IN", { timeZone: "Asia/Kolkata" }); // IST
  const sortTime = now.toISOString(); // UTC ISO string for sorting

  const message = `${person} redeemed ${points} points for ${redeemFor}`;

  const entry = {
    message,
    displayTime,
    sortTime
  };

  data.log.push(entry);

  await updateDoc(docRef, {
    Aakarsh: data.Aakarsh,
    Rishika: data.Rishika,
    log: arrayUnion(entry)
  });

  loadData();
}


  // Attach event listeners
  document.getElementById("logBtn").addEventListener("click", addTransaction);
  document.getElementById("redeemBtn").addEventListener("click", redeemPoints);

  // Load initial data
  loadData();
</script>

</body>
</html>

















